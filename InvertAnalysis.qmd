---
title: "InvertebratesAnalysis"
author: "Trevor Harrington"
format: html
editor: visual
execute: 
  keep-md: TRUE
---

# Invertebrate Biodiversity in Riffle-Pool Streams: The Influence of Water Flow Characteristics.

```{r}
#Load all valuable libraries to manipulate and display data
library(readxl)
library(tidyverse)
library(kableExtra)
library(ggplot2)
library(tidymodels)
library(janitor)
library(magrittr)

#data is saved locally, not accessable off of this PC
invertebrates <- read_excel("Invertebrates in R/inverts_class_data.xlsx") %>%
  
clean_names() 


```

## Initial Data Split

```{r}
   # Initial data intake / hypothesis generating exploration before further data investigation.
   
   my_data_splits <- initial_split(invertebrates, prop = 0.5,
                                   pool = 1) 

exploratory_data <- training(my_data_splits)
test_data <- testing(my_data_splits)

exploratory_data %>%
  
   t %>% as.data.frame( row.names = NULL, optional = FALSE,
              cut.names = FALSE, col.names = names('S1', 'S2'), fix.empty.names = TRUE,
              check.names = !optional,
              stringsAsFactors = FALSE) %>%

kable() %>%
  kable_styling(bootstrap_options = c("hover", "striped"))


```

```{r}
exploratory_data %>%

  mutate('total_individual_present' = bivalvia + gastropoda + diptera + turbellaria + oliggocheata + hirundinea + decapoda + amphipod + isopod + trombidiforme + plecoptera + trichoptera + ephemroptera + megaloptera + coleoptera + hemiptera + odonta + lepidoptera) %>%

  mutate(flow_volume_m_sqrd = stream_width * stream_depth * flow_velocity) %>%
  
summarise(
  "average species present" = mean(total_individuals_present),
  "'Unit' flow" = mean(flow_volume_m_sqrd),
  "Riffle/pool" = list(riffle_pool),
  )%>%

kable() %>%
  kable_styling(bootstrap_options = c("hover", "striped"))

```

### What can be inferred?

-   Using exploratory data, the first things to notice are that there are multiple locations where data has been collected.

-   data for this set are the species of invertebrates that were identified in two streams, across four locations. Each stream was measured at one 'riffle run' and one 'pool' section

    -    **riffle stream** is a shallow section moving water characterized by rapid flow with a rocky or gravel bottom, where the water flows over small obstructions and creates a 'riffling' sound. Riffle sections of a stream are typically found in the most upstream part of a stream where the slope is steeper and the water flow is more energetic.

    -   A **pool stream** is a deeper section of a stream characterized by a slower flow rate with a smooth bottom, where the water flows around larger obstructions and creates a pooling effect. Pools are typically found in the lower half of a stream where the gradient is less steep and the water flow reduced.

        ::: {.callout-note appearance="simple"}
        Considering the characteristics of riffle and pool streams, it is possible some hypotheses could be generate on which would be more conducive of some species more then others.

        -   The invertebrate species found in the pool sites of one stream should be more similar to those in the pool sites of the other stream compared to the riffle sites of the two streams.

        -   The pool environment is more conducive to aquatic life, which may include invertebrate species in which case a larger population should be found in the pool sites compared to the riffle sites in either stream.

        -    are there any species that can be identified as only found in riffle runs or pools?
        :::

```{r}
invertebrates %>%
  
  pivot_longer(cols = 6:23,
               names_to = "order",
               values_to = "count") %>%
  
  filter_if(vars('count' == 0)) # did not work, try below or mutate


filter (count !> 0)

  kable() %>%
    kable_styling(bootstrap_options = c("hover", "striped"))
```

Considering Hypothesis on Initial Data Split

### Potential Questions for Investigation

Investigation of raw data suggests some potential questions could be related to a preference of species towards one type of stream versus another, with potentially some variation of these four testing sites providing an environment that is suitably favorable for a range of species.

This data has some significant limitations that prevent a in-depth investigation of the cause for success over one species versus another. Namely, this data lacks temporal, geographical, and methodology data that could provide insight for what other variables may contribute to the data collected. This data also lacks any measurement units for flow rate and width/depth, meaning they do not provide sufficient data to make any assumptions on the actual size, depth, or total flow of the stream to contribute in analysis. Overall, this data will be most valuable for

-   How are the characteristics between Site 1 & 2 different? Which combination of features seems to be the most ideal for invertebrate success.

    -   Is large species count the same as biodiversity? Does the site with largest amount of species also have the most unique species, or is favorable for only a few?

-   Something we are becoming increasingly aware of is the impact of dams on aquatic habitats. If this stream is or is not dammed, there could be some inference or comparison made with other researchers findings and how the presents of man-made obstacles could impact invertebrate habitats.

    -   likely, this kind of inference would require a larger dataset to work with, but it could potentially provide some useful insight on making comparisons with other analysis conducted on a similar topic.

-   

    -   

    ```{r}
    invertebrates %>%
      
       pivot_longer(invertebrates,
                   cols = 6:23,
                   names_to = "order",
                   values_to = "count")
      

      
    ```

```{r}
invertebrates %>% #simple exploratory analysis 
  
  mutate(total_individuals_present = bivalvia + diptera + turbellaria + oliggocheata + hirundinea + decapoda + amphipod + isopod + trombidiforme + plecoptera + trichoptera + ephemroptera + megaloptera + coleoptera + hemiptera + odonta + lepidoptera) %>%

mutate(flow_volume_m_sqrd = stream_width * stream_depth * flow_velocity) %>%
  
  group_by(site, riffle_pool) %>%
  
summarise(
  "average species present" = mean(total_individuals_present),
  "'Unit' flow" = mean(flow_volume_m_sqrd),
  "Riffle/pool" = list(riffle_pool),
  ) %>%

kable() %>%
  kable_styling(bootstrap_options = c("hover", "striped"))


```

#### Viewing Distribution of Species Across Sites

**Hypotheses:**

**NULL Hypothesis:** Characteristics
